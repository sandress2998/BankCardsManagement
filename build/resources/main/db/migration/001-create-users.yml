databaseChangeLog:
  # Включаем расширение UUID для PostgreSQL
  - changeSet:
      context: prod
      id: 001-enable-uuid-extension
      author: developer
      dbms: postgresql
      changes:
        - sql:
            sql: CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
      rollback:
        - sql:
            sql: DROP EXTENSION IF EXISTS "uuid-ossp";

  # Создание таблицы пользователей + добавление CHECK через SQL (совместимо с Liquibase Community)
  - changeSet:
      id: 002-create-user-info-table
      author: developer
      changes:
        - createTable:
            tableName: user_info
            columns:
              - column:
                  name: id
                  type: uuid
                  defaultValueComputed: uuid_generate_v4()
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: login
                  type: varchar(100)
                  constraints:
                    unique: true
                    nullable: false
              - column:
                  name: password
                  type: varchar(60)
                  constraints:
                    nullable: false
              - column:
                  name: role
                  type: varchar(20)
                  constraints:
                    nullable: false
        # Заменяем addCheckConstraint (Pro) на чистый SQL (Community)
        - sql:
            splitStatements: false
            stripComments: true
            sql: |
              ALTER TABLE user_info
              ADD CONSTRAINT chk_user_role
              CHECK (role IN ('USER','ADMIN'));
      rollback:
        # Сначала убираем CHECK-ограничение (на случай, если понадобится откат без DROP TABLE)
        - sql:
            splitStatements: false
            stripComments: true
            sql: |
              ALTER TABLE IF EXISTS user_info
              DROP CONSTRAINT IF EXISTS chk_user_role;
        # Затем удаляем таблицу
        - dropTable:
            tableName: user_info
